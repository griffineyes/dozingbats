<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Where's the Bat?</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap');
        .font-comic { font-family: 'Comic Neue', cursive; }
        @keyframes zoomIn {
            from { transform: scale(0.1); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .animate-zoom-in { animation: zoomIn 0.8s ease-out; }
        body { margin: 0; overflow: hidden; }
    </style>
</head>
<body>
    <div id="game-container" class="w-full h-screen relative overflow-hidden cursor-none">
        <!-- Night Sky Background -->
        <div class="absolute inset-0 bg-gradient-to-b from-indigo-900 via-purple-900 to-indigo-800"></div>
        
        <!-- Stars -->
        <div id="stars"></div>
        
        <!-- Moon -->
        <div id="moon" class="absolute top-8 right-8"></div>
        
        <!-- Start Screen -->
        <div id="start-screen" class="flex flex-col items-center justify-center h-full relative z-10">
            <div class="text-center bg-black bg-opacity-50 p-8 rounded-3xl border-4 border-yellow-300">
                <h1 class="text-5xl font-bold text-yellow-300 mb-4 font-comic">ü¶á Where's the Bat? ü¶á</h1>
                <p class="text-xl text-blue-200 mb-8 font-comic">Find the hidden bat in the moonlit night!</p>
                <button onclick="startGame()" class="px-10 py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-full text-2xl font-bold hover:scale-105 transition-transform shadow-lg border-2 border-yellow-300 font-comic">
                    üî¶ Start Hunt
                </button>
            </div>
        </div>
        
        <!-- Game Screen -->
        <div id="game-screen" class="hidden relative w-full h-full">
            <div id="flashlight-area" class="absolute inset-0"></div>
            <div id="bat-container" class="absolute"></div>
            <div id="flashlight-circle" class="absolute w-32 h-32 rounded-full border-4 border-yellow-400 pointer-events-none"></div>
        </div>
        
        <!-- Victory Screen -->
        <div id="victory-screen" class="hidden flex flex-col items-center justify-center h-full relative z-10">
            <div class="text-center bg-black bg-opacity-70 p-8 rounded-3xl border-4 border-yellow-300">
                <div id="victory-bat" class="animate-zoom-in mb-6"></div>
                <div class="mb-4">
                    <div id="victory-text" class="text-4xl font-bold text-yellow-300 mb-2 font-comic"></div>
                    <div id="moon-text" class="text-lg text-blue-200 font-comic"></div>
                </div>
                <button onclick="resetGame()" class="px-8 py-4 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-full text-xl font-bold hover:scale-105 transition-transform shadow-lg border-2 border-yellow-300 font-comic">
                    üåô Hunt Again?
                </button>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            started: false,
            batFound: false,
            mousePos: { x: 0, y: 0 },
            batPosition: { x: 0, y: 0 },
            currentPose: 0,
            moonPhase: 0
        };

        const moonPhaseNames = ["New Moon", "Waxing Crescent", "First Quarter", "Waxing Gibbous", 
                               "Full Moon", "Waning Gibbous", "Last Quarter", "Waning Crescent"];

        const victoryMessages = ["üí§ SLEEPY BAT! üí§", "ü¶á FLYING HIGH! ü¶á", "üëÅÔ∏è WIDE AWAKE! üëÅÔ∏è", "üßõ SPOOKY BAT! üßõ"];

        function createStars() {
            const starsContainer = document.getElementById('stars');
            starsContainer.innerHTML = '';
            
            // Small twinkling stars
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'absolute w-1 h-1 bg-yellow-200 rounded-full animate-pulse';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 70 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (2 + Math.random() * 2) + 's';
                starsContainer.appendChild(star);
            }
            
            // Larger stars
            for (let i = 0; i < 15; i++) {
                const starWrapper = document.createElement('div');
                starWrapper.className = 'absolute animate-ping';
                starWrapper.style.left = Math.random() * 100 + '%';
                starWrapper.style.top = Math.random() * 60 + '%';
                starWrapper.style.animationDelay = Math.random() * 4 + 's';
                starWrapper.style.animationDuration = (3 + Math.random() * 2) + 's';
                
                const star = document.createElement('div');
                star.className = 'w-2 h-2 bg-white rounded-full opacity-80';
                starWrapper.appendChild(star);
                starsContainer.appendChild(starWrapper);
            }
        }

        function createMoon(phase) {
            const moonContainer = document.getElementById('moon');
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '80');
            svg.setAttribute('height', '80');
            svg.setAttribute('viewBox', '0 0 100 100');
            
            if (phase === 0) { // New Moon
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', '50');
                circle.setAttribute('cy', '50');
                circle.setAttribute('r', '20');
                circle.setAttribute('fill', '#1a1a2e');
                circle.setAttribute('stroke', '#4a4a6a');
                circle.setAttribute('stroke-width', '2');
                svg.appendChild(circle);
            } else if (phase === 4) { // Full Moon
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', '50');
                circle.setAttribute('cy', '50');
                circle.setAttribute('r', '20');
                circle.setAttribute('fill', '#f5f5dc');
                circle.setAttribute('stroke', '#e6e68a');
                circle.setAttribute('stroke-width', '2');
                svg.appendChild(circle);
                
                // Add craters
                const crater1 = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                crater1.setAttribute('cx', '45');
                crater1.setAttribute('cy', '45');
                crater1.setAttribute('r', '3');
                crater1.setAttribute('fill', '#e6e68a');
                crater1.setAttribute('opacity', '0.7');
                svg.appendChild(crater1);
            } else {
                // Simplified other phases
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', '50');
                circle.setAttribute('cy', '50');
                circle.setAttribute('r', '20');
                circle.setAttribute('fill', phase > 4 ? '#f5f5dc' : '#1a1a2e');
                circle.setAttribute('stroke', phase > 4 ? '#e6e68a' : '#4a4a6a');
                circle.setAttribute('stroke-width', '2');
                svg.appendChild(circle);
            }
            
            moonContainer.innerHTML = '';
            moonContainer.appendChild(svg);
        }

        function createBat(pose, isRevealed = false) {
            const size = isRevealed ? 200 : 80;
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', size);
            svg.setAttribute('height', size);
            svg.setAttribute('viewBox', '0 0 100 100');
            
            // Simplified bat based on pose
            if (pose === 0) { // Sleeping
                // Branch
                const branch = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                branch.setAttribute('x', '20');
                branch.setAttribute('y', '15');
                branch.setAttribute('width', '60');
                branch.setAttribute('height', '6');
                branch.setAttribute('fill', '#4a3728');
                branch.setAttribute('rx', '3');
                svg.appendChild(branch);
                
                // Body
                const body = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
                body.setAttribute('cx', '50');
                body.setAttribute('cy', '55');
                body.setAttribute('rx', '18');
                body.setAttribute('ry', '25');
                body.setAttribute('fill', '#4a4a4a');
                body.setAttribute('stroke', '#333');
                body.setAttribute('stroke-width', '2');
                svg.appendChild(body);
                
                // Head
                const head = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                head.setAttribute('cx', '50');
                head.setAttribute('cy', '75');
                head.setAttribute('r', '12');
                head.setAttribute('fill', '#666');
                head.setAttribute('stroke', '#333');
                head.setAttribute('stroke-width', '2');
                svg.appendChild(head);
                
                if (isRevealed) {
                    // Sunglasses
                    const glasses = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    glasses.setAttribute('x', '40');
                    glasses.setAttribute('y', '72');
                    glasses.setAttribute('width', '20');
                    glasses.setAttribute('height', '4');
                    glasses.setAttribute('rx', '2');
                    glasses.setAttribute('fill', '#000');
                    svg.appendChild(glasses);
                }
            }
            
            return svg;
        }

        async function playSound(type) {
            await Tone.start();
            
            if (type === 'start') {
                const synth = new Tone.Synth({
                    oscillator: { type: "triangle" },
                    envelope: { attack: 0.3, decay: 0.5, sustain: 0.3, release: 0.8 }
                }).toDestination();
                synth.triggerAttackRelease("G4", "2n");
                setTimeout(() => synth.triggerAttackRelease("B4", "2n"), 300);
                setTimeout(() => synth.triggerAttackRelease("D5", "1n"), 600);
                setTimeout(() => synth.dispose(), 2000);
            } else if (type === 'found') {
                const synth = new Tone.PolySynth().toDestination();
                synth.triggerAttackRelease(["E4", "G#4", "B4", "E5"], "4n");
                setTimeout(() => synth.dispose(), 1000);
            }
        }

        function startGame() {
            gameState.started = true;
            gameState.batFound = false;
            gameState.batPosition.x = Math.random() * 70 + 15;
            gameState.batPosition.y = Math.random() * 60 + 20;
            gameState.currentPose = Math.floor(Math.random() * 4);
            gameState.moonPhase = Math.floor(Math.random() * 8);
            
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            createMoon(gameState.moonPhase);
            
            // Create bat
            const batContainer = document.getElementById('bat-container');
            batContainer.innerHTML = '';
            batContainer.appendChild(createBat(gameState.currentPose));
            batContainer.style.left = gameState.batPosition.x + '%';
            batContainer.style.top = gameState.batPosition.y + '%';
            batContainer.style.transform = 'translate(-50%, -50%)';
            
            playSound('start');
        }

        function resetGame() {
            gameState.started = false;
            gameState.batFound = false;
            
            document.getElementById('victory-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('hidden');
        }

        function checkBatClick(e) {
            if (gameState.batFound) return;
            
            const rect = document.getElementById('game-container').getBoundingClientRect();
            const clickX = ((e.clientX - rect.left) / rect.width) * 100;
            const clickY = ((e.clientY - rect.top) / rect.height) * 100;
            
            const distance = Math.sqrt(
                Math.pow(clickX - gameState.batPosition.x, 2) + 
                Math.pow(clickY - gameState.batPosition.y, 2)
            );
            
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            const flashlightDistance = Math.sqrt(
                Math.pow(mouseX - gameState.mousePos.x, 2) + 
                Math.pow(mouseY - gameState.mousePos.y, 2)
            );
            
            if (flashlightDistance < 60 && distance < 12) {
                gameState.batFound = true;
                
                document.getElementById('game-screen').classList.add('hidden');
                document.getElementById('victory-screen').classList.remove('hidden');
                
                // Show victory bat
                const victoryBat = document.getElementById('victory-bat');
                victoryBat.innerHTML = '';
                victoryBat.appendChild(createBat(gameState.currentPose, true));
                
                document.getElementById('victory-text').textContent = victoryMessages[gameState.currentPose];
                document.getElementById('moon-text').textContent = `Found under the ${moonPhaseNames[gameState.moonPhase]}!`;
                
                playSound('found');
            }
        }

        // Event listeners
        document.addEventListener('mousemove', (e) => {
            if (!gameState.started || gameState.batFound) return;
            
            const rect = document.getElementById('game-container').getBoundingClientRect();
            gameState.mousePos.x = e.clientX - rect.left;
            gameState.mousePos.y = e.clientY - rect.top;
            
            // Update flashlight
            const flashlightArea = document.getElementById('flashlight-area');
            flashlightArea.style.webkitMaskImage = `radial-gradient(circle 60px at ${gameState.mousePos.x}px ${gameState.mousePos.y}px, white 0%, white 100%, transparent 100%)`;
            flashlightArea.style.maskImage = `radial-gradient(circle 60px at ${gameState.mousePos.x}px ${gameState.mousePos.y}px, white 0%, white 100%, transparent 100%)`;
            flashlightArea.style.background = 'linear-gradient(to bottom, #60a5fa, #34d399)';
            
            const flashlightCircle = document.getElementById('flashlight-circle');
            flashlightCircle.style.left = (gameState.mousePos.x - 64) + 'px';
            flashlightCircle.style.top = (gameState.mousePos.y - 64) + 'px';
        });

        document.getElementById('game-screen').addEventListener('click', checkBatClick);

        // Initialize
        createStars();
    </script>
</body>
</html>